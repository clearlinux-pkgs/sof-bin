From 05939225d70b8a4a087974ae9aa82ee0d4f32bf3 Mon Sep 17 00:00:00 2001
From: Auke Kok <auke-jan.h.kok@intel.com>
Date: Thu, 5 Mar 2020 14:27:31 -0800
Subject: [PATCH] Convert `go.sh` script into a classic `Makefile` with DESTDIR
 support.

---
 Makefile | 33 +++++++++++++++++++++++++++++++++
 go.sh    | 55 -------------------------------------------------------
 2 files changed, 33 insertions(+), 55 deletions(-)
 create mode 100755 Makefile
 delete mode 100755 go.sh

diff --git a/Makefile b/Makefile
new file mode 100755
index 0000000..3bde7c5
--- /dev/null
+++ b/Makefile
@@ -0,0 +1,33 @@
+
+#
+# This script installs the firmware files in the place where the linux
+# firmware loading system expects them - `/lib/firmware`. It supports
+# DESTDIR installations for package manager software. You should just
+# have to `sudo make install` to put the files in the correct location.
+#
+
+VERSION ?= v1.4.2
+
+FIRMWAREDIR ?= $(DESTDIR)/lib/firmware/intel
+
+all:
+
+check:
+
+install:
+	mkdir -p $(FIRMWAREDIR)
+	cp -rf lib/firmware/intel $(FIRMWAREDIR)/
+
+	ln -s $(VERSION)/sof-bdw-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-bdw.ri
+	ln -s $(VERSION)/sof-byt-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-byt.ri
+	ln -s $(VERSION)/sof-cht-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-cht.ri
+
+	ln -s $(VERSION)/intel-signed/sof-apl-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-apl.ri
+	ln -s $(VERSION)/intel-signed/sof-apl-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-glk.ri
+	ln -s $(VERSION)/intel-signed/sof-cnl-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-cfl.ri
+	ln -s $(VERSION)/intel-signed/sof-cnl-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-cnl.ri
+	ln -s $(VERSION)/intel-signed/sof-cnl-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-cml.ri
+	ln -s $(VERSION)/intel-signed/sof-icl-$(VERSION).ri $(FIRMWAREDIR)/intel/sof-icl.ri
+
+	ln -s sof-tplg-$(VERSION) $(FIRMWAREDIR)/sof-tplg
+
diff --git a/go.sh b/go.sh
deleted file mode 100755
index 0600f7c..0000000
--- a/go.sh
+++ /dev/null
@@ -1,55 +0,0 @@
-# TODO: Helper script - automate the mundane !
-
-# This script should do several things.
-#
-# 1) Install the firmware and topologies in the correct target directories
-#    depending on PREFIX and vendor. PREFIX should be set as cmd line argument
-#    otherwise default to /lib/firmware. "install" rule.
-#
-# 2) As 1, but for the ldc files. This is the "install_debug" rule.
-#
-# 3) Take a SOF tag as cmd line argument, checkout tag locally, build topologies
-#    and copy them here under tag name directory. "update-tplg" rule.
-#
-# 4) As 3, but for firmware and sign with public key. Build with XCC where
-#    possible or download binaries (signed with any key) from external resource.
-#    "update-firmware" rule.
-#
-# 5) Publish all new topologies and firmwares by commiting and pushing this
-#    local copy of repo to upstream master. This should check for any missing
-#    files (e.g. signed public releases should match signed intel releases).
-#    "publish" rule. 
-
-ROOT=
-INTEL_PATH=lib/firmware/intel
-VERSION=v1.4.2
-
-echo "Installing Intel firmware and topology $VERSION to $INTEL_PATH"
-
-# wipe previous releases
-rm -rf ${ROOT}/${INTEL_PATH}/sof/*
-rm -rf ${ROOT}/${INTEL_PATH}/sof-tplg-*
-rm -rf ${ROOT}/${INTEL_PATH}/sof-tplg
-
-# copy to destination
-cd lib/firmware
-cp -rf intel ${ROOT}/lib/firmware
-
-# add symlinks
-cd ${ROOT}/${INTEL_PATH}/sof
-
-ln -s ${VERSION}/sof-bdw-${VERSION}.ri sof-bdw.ri
-ln -s ${VERSION}/sof-byt-${VERSION}.ri sof-byt.ri
-ln -s ${VERSION}/sof-cht-${VERSION}.ri sof-cht.ri
-ln -s ${VERSION}/intel-signed/sof-apl-${VERSION}.ri sof-apl.ri
-ln -s ${VERSION}/intel-signed/sof-apl-${VERSION}.ri sof-glk.ri
-ln -s ${VERSION}/intel-signed/sof-cnl-${VERSION}.ri sof-cfl.ri
-ln -s ${VERSION}/intel-signed/sof-cnl-${VERSION}.ri sof-cnl.ri
-ln -s ${VERSION}/intel-signed/sof-cnl-${VERSION}.ri sof-cml.ri
-ln -s ${VERSION}/intel-signed/sof-icl-${VERSION}.ri sof-icl.ri
-
-
-cd ..
-ln -s sof-tplg-${VERSION} sof-tplg
-
-echo "Done installing Intel firmware and topology $VERSION"
-- 
2.25.1

